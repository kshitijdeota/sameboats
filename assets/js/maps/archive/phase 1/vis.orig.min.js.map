{"version":3,"sources":["archive/phase 1/vis.orig.js"],"names":["CreateMap","[object Object]","this","data","itineraries","trajectories","intersections","places","authors","continents","width","window","innerWidth","height","innerHeight","loading","range","Date","date_start","date_end","mode","d3","select","classed","ttime","_elem","filter","d","length","process_data","setup","generate","self","datasets","forEach","push","filepath","json","e","_d","loading_manager","keys","k","split","trim","join","toLowerCase","PlaceName","author_ids","AuthorID","tabs","selectAll","svg","append","attr","on","elem","id","switch_mode","generate_map","generate_routes","focus","sidebar_tabs","sidebar_mode","event","stopPropagation","unfocus","generate_sidebar","scale","time","domain","scale_axis","axis","orient","ticks","tickSize","tickPadding","slide","slider","value","scale_value_converter","orientation","margin","animate","evt","v_1","v_2","update_datebar","update","_val","s","nice","month","invert","call","last","style","intersections_unique","trajectories_unique","points_target","points_g","points_backs","points_03","points_02","points_01","lines_target","lines_g","lines","map","projection","geo","mercator","translate","path","features","topojson","feature","objects","filter_data","holder","entries","n","key","figures","__d","Likelihood","lists","_01","values","_02","_03","t","EndDate","PlaceID","tier","i","j","PlaceID_End","Likelihood_End","generate_lines","enter","exit","remove","indexOf","source","target","p_1","p_2","Long","Lat","dx","dy","dr","Math","sqrt","generate_points","r_scale","linear","p","transition","duration","r_tot","parentNode","__data__","o_scale","html","items","items_date","str","StartDate","a1","a2","p1","p2","f","format","visH","routes_g","routes_lines_bknd","routes_labels","routes_lines","routes_stops","routes_points","routes_points_labels","routes_scale","starts","min","text","t1","t2","_id","tear_down","opp","vis","get_data","selection","prototype","first","size"],"mappings":"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","file":"../../../archive/phase 1/vis.orig.min.js","sourcesContent":["class CreateMap {\n\t\n\tconstructor(){\n\n\t\tthis.data = {};\n\n\t\tthis.itineraries = {};\n\t\tthis.trajectories = {};\n\t\tthis.intersections = {};\n\t\tthis.places = {};\n\t\tthis.authors = {};\n\t\tthis.continents = {};\n\n\t\t//store screen height and width\n\t\tthis.width = window.innerWidth;\n\t\tthis.height = window.innerHeight;\n\n\t\tthis.loading = [];\n\n\t\tthis.range = [\n\t\t\tnew Date(1890,1,1),\n\t\t\tnew Date(2010,1,1)\n\t\t];\n\t\tthis.date_start = this.range[0];\n\t\tthis.date_end = this.range[1];\n\n\t\tthis.mode = d3.select('#_01').classed('selected') ? 1 : 2;\n\n\t\tthis.ttime = 45;\n\t}\n\n\tloading_manager(_elem){\n\t\tvar self = this;\n\t\tvar empty = false;\n\n\t\t//remove name of retrieved JSON document from loading array\n\t\tself.loading = self.loading.filter(function(d){ return d !== _elem; });\n\n\t\tif(self.loading.length === 0){\n\t\t\tself.process_data();\n\t\t\tself.setup();\n\t\t\tself.generate();\n\t\t}\n\t}\n\n\tget_data(){\n\t\tvar self = this;\n\t\tvar datasets = ['author_ids','intersections','itineraries','places','continents'];\n\n\t\tdatasets.forEach(function(d){ self.loading.push(d); });\n\t\tdatasets.forEach(function(d){\n\n\t\t\tvar filepath = 'data/three_' +d +'.json';\n\n\t\t\td3.json(filepath,function(e,_d){\n\t\t\t\tif(!e){\n\t\t\t\t\tself.data[d] = _d;\n\t\t\t\t\tself.loading_manager(d);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprocess_data(){\n\t\tvar self = this;\n\t\t\n\t\tself.continents = self.data.continents;\n\n\t\t//WEAKPOINT ** fix later\n\t\t//places\n\t\td3.keys(self.data.places).forEach(function(d){\n\t\t\tvar k = d.split(',');\n\t\t\tk[0] = k[0].trim().split(' ').join('-');\n\t\t\tk[1] = k[1].trim().split(' ').join('-');\n\t\t\tk = k.join('_').toLowerCase();\n\t\t\tself.places[k] = self.data.places[d];\n\t\t\tself.places[k].PlaceName = d;\n\t\t});\n\n\t\t//authors\n\t\td3.keys(self.data.author_ids).forEach(function(k){\n\t\t\tself.authors[self.data.author_ids[k]] = k;\n\t\t});\n\n\t\t//intersections\n\t\tself.intersections = self.data.intersections;\n\n\t\t//trajectories\n\t\tself.trajectories = {};\n\n\t\t//itineraries\n\t\tself.itineraries = {};\n\t\td3.keys(self.authors).forEach(function(d){\n\t\t\tif(!self.itineraries[d]){ self.itineraries[d] = []; }\n\t\t});\n\t\td3.keys(self.data.itineraries).forEach(function(d){\n\t\t\tself.data.itineraries[d].forEach(function(_d){\n\t\t\t\tself.itineraries[_d.AuthorID].push(_d);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup(){\n\t\tvar self = this;\n\t\tvar tabs = d3.selectAll('.tab');\n\n\t\tthis.svg = d3.select('#container')\n\t\t\t.append('svg')\n\t\t\t.attr('width',this.width);\n\n\t\ttabs.on('click',function(d){\n\t\t\tvar elem = d3.select(this),\n\t\t\t\t\tid = +elem.attr('id').split('_')[1];\n\t\t\t\n\t\t\tself.switch_mode(id);\n\n\t\t\ttabs.classed('selected',false);\n\t\t\telem.classed('selected',true);\n\t\t});\n\t}\n\n\tgenerate(){\n\t\tif(this.mode === 1){\n\t\t\tthis.generate_map();\n\t\t} else{\n\t\t\tthis.generate_routes();\n\t\t}\n\t}\n\n\tgenerate_map(){\n\t\tvar self = this;\n\t\tvar focus = false;\n\t\tvar sidebar_tabs = d3.selectAll('.sidebar_tab'),\n\t\t\t\tsidebar_mode = 1;\n\n\t\tthis.svg.attr('height',this.height);\n\n\t\t//click handlers\n\t\tself.svg.on('click',function(d){\n\t\t\td3.event.stopPropagation();\n\t\t\tunfocus();\n\t\t\tgenerate_sidebar();\n\t\t});\n\t\tsidebar_tabs.on('click',function(d){\n\t\t\tvar elem = d3.select(this);\n\t\t\tsidebar_tabs.classed('selected',false);\n\t\t\telem.classed('selected',true);\n\t\t\tsidebar_mode = +elem.attr('id').split('_')[1];\n\t\t\tgenerate_sidebar();\n\t\t});\n\n\t\t//slider\n\t\tvar scale = d3.time.scale()\n\t\t\t.domain(this.range)\n\t\t\t;\n\t\tvar scale_axis = d3.svg.axis()\n\t\t\t.orient('right')\n\t\t\t.ticks(20)\n\t\t\t.tickSize(30)\n\t\t\t.tickPadding(12)\n\t\t\t;\n\t\tvar slide = d3.slider()\n\t\t\t.scale(scale)\n\t\t\t.axis(scale_axis)\n\t\t\t.value([\n\t\t\t\tscale_value_converter(this.range[1]),\n\t\t\t\tscale_value_converter(this.range[0])\n\t\t\t])\n\t\t\t.orientation('vertical')\n\t\t\t.margin(0)\n\t\t\t.animate(false)\n\t\t\t.on('slide',function(evt,value){\n\t\t\t\tvar v_1 = value[1] instanceof Date ? value[1] : new Date(value[1]),\n\t\t\t\t\t\tv_2 = value[0] instanceof Date ? value[0] : new Date(value[0]);\n\t\t\t\t\n\t\t\t\tself.date_start = scale_value_converter(v_1);\n\t\t\t\tself.date_end = scale_value_converter(v_2);\n\n\t\t\t\t// unfocus();\n\t\t\t\tupdate_datebar();\n\t\t\t\tupdate();\n\t\t\t})\n\t\t\t.on('slideend',function(evt,value){\n\t\t\t\tupdate();\n\t\t\t});\n\n\t\t//the slider library, though lightweight, is flawed\n\t\t//use this to convert the date values properly\n\t\tfunction scale_value_converter(_val){\n\t\t\tvar s = d3.time.scale()\n\t\t\t\t.domain(scale.domain())\n\t\t\t\t.range([0,self.height])\n\t\t\t\t.nice(d3.time.month)\n\t\t\t\t;\n\t\t\treturn s.invert((self.height -(s(_val))));\n\t\t}\n\n\t\tvar slider = d3.select('#slider .slider_body').call(slide);\n\t\td3.selectAll('#slider .slider_body .tick').last().style('display','none');\n\t\t\n\t\tupdate_datebar();\n\n\t\t//map\n\t\tvar projection = d3.geo.mercator()\n\t\t\t.scale(200)\n\t\t\t.translate([self.width*0.5,self.height*0.65])\n\t\t\t;\n\t\tvar path = d3.geo.path().projection(projection);\n\n\t\tvar features = topojson.feature(self.continents,self.continents.objects.continents);\n\t\tvar intersections,\n\t\t\t\tintersections_unique,\n\t\t\t\ttrajectories,\n\t\t\t\ttrajectories_unique;\n\t\tvar points_target,\n\t\t\t\tpoints_g,\n\t\t\t\tpoints_backs,\n\t\t\t\tpoints_03,\n\t\t\t\tpoints_02,\n\t\t\t\tpoints_01,\n\n\t\t\t\tlines_target,\n\t\t\t\tlines_g,\n\t\t\t\tlines;\n\n\t\t//draw vector map\n\t\tvar map;\n\t\tmap = self.svg.selectAll('path.map')\n\t\t\t.data([features]);\n\t\tmap.enter().append('path')\n\t\t\t.classed('map',true);\n\t\tmap\n\t\t\t.attr('d',path)\n\t\t\t;\n\t\tmap.exit().remove();\n\n\t\tfunction filter_data(){\n\n\t\t\t//clear objects\n\t\t\tintersections = {};\n\t\t\tintersections_unique = {};\n\t\t\ttrajectories = {};\n\t\t\ttrajectories_unique = {};\n\n\t\t\t//INTERSECTIONS\n\t\t\t//filter by date range\n\t\t\tvar holder = d3.entries(self.intersections).filter(function(d){\n\t\t\t\tvar n = new Date(d.key);\n\t\t\t\treturn n >=self.date_start && n <=self.date_end;\n\t\t\t});\n\t\t\t//get distinct places\n\t\t\t//slot author IDs into place\n\t\t\t//highest likelihood score wins\n\t\t\tholder.forEach(function(d){\n\t\t\t\tif(d3.keys(d.value).length >0){\n\t\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\t\tif(!intersections[_d]){ \n\t\t\t\t\t\t\tintersections[_d] = {}; \n\t\t\t\t\t\t\tintersections[_d].figures = {}; \n\t\t\t\t\t\t}\n\t\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\t\tif(!intersections[_d].figures[__d.AuthorID] || intersections[_d].figures[__d.AuthorID] >__d.Likelihood){\n\t\t\t\t\t\t\t\tintersections[_d].figures[__d.AuthorID] = __d.Likelihood;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\t//tally up totals\n\t\t\td3.keys(intersections).forEach(function(d){\n\t\t\t\tintersections[d].lists = {};\n\t\t\t\tintersections[d].lists._01 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 1; });\n\t\t\t\tintersections[d].lists._02 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 2; });\n\t\t\t\tintersections[d].lists._03 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 3; });\n\t\t\t});\n\t\t\t//make list of unique intersections per place\n\t\t\tholder.forEach(function(d){\n\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\tif(!intersections_unique[_d]){ intersections_unique[_d] = []; }\n\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\tif(intersections_unique[_d].filter(function(t){ return t.AuthorID === __d.AuthorID && t.EndDate === __d.EndDate; }).length === 0){\n\t\t\t\t\t\t\tintersections_unique[_d].push(__d);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t//TRAJECTORIES\n\t\t\tholder.forEach(function(d){\n\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\tif(!trajectories[__d.AuthorID]){ trajectories[__d.AuthorID] = []; }\n\t\t\t\t\t\tif(trajectories[__d.AuthorID].filter(function(t){ return t.PlaceID === __d.PlaceID && t.EndDate === __d.EndDate; }).length === 0){\n\t\t\t\t\t\t\ttrajectories[__d.AuthorID].push(__d);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\t//pair up start and end points\n\t\t\tvar tier = 0;\n\t\t\tfor(var i=0; i<d3.keys(trajectories).length; i++){\n\t\t\t\tfor(var j=0; j<trajectories[d3.keys(trajectories)[i]].length -1; j++){\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].PlaceID_End = trajectories[d3.keys(trajectories)[i]][j+1].PlaceID;\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].Likelihood_End = trajectories[d3.keys(trajectories)[i]][j+1].Likelihood;\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].tier = tier;\n\t\t\t\t\ttier=(j%2)*10;\n\t\t\t\t} \n\t\t\t}\n\t\t\t//make list of unique trajectories per place\n\t\t\td3.keys(intersections).forEach(function(d){\n\t\t\t\tif(!trajectories_unique[d]){ trajectories_unique[d] = []; }\n\t\t\t});\n\t\t\td3.values(trajectories).forEach(function(d){\n\t\t\t\td.forEach(function(_d){\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID]){ trajectories_unique[_d.PlaceID] = []; }\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID_End]){ trajectories_unique[_d.PlaceID_End] = []; }\n\t\t\t\t\ttrajectories_unique[_d.PlaceID].push(_d);\n\t\t\t\t\tif(_d.PlaceID_End){ trajectories_unique[_d.PlaceID_End].push(_d); }\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction generate_lines(){\n\n\t\t\tlines_target = self.svg.selectAll('g.lines_target')\n\t\t\t\t.data([self]);\n\t\t\tlines_target.enter().append('g')\n\t\t\t\t.classed('lines_target',true);\n\t\t\tlines_target.exit().remove();\n\n\t\t\tlines_g = lines_target.selectAll('g.lines_g')\n\t\t\t\t.data(d3.entries(trajectories));\n\t\t\tlines_g.enter().append('g')\n\t\t\t\t.classed('lines_g',true);\n\t\t\tlines_g\n\t\t\t\t.attr('class',function(d){\n\t\t\t\t\treturn 'lines_g id_' +d3.keys(self.authors).indexOf(d.key);\n\t\t\t\t});\n\t\t\tlines_g.exit().remove();\n\n\t\t\tlines = lines_g.selectAll('path.line')\n\t\t\t\t.data(function(d){ return d.value.filter(function(_d){ return _d.PlaceID_End; }); });\n\t\t\tlines.enter().append('path')\n\t\t\t\t.classed('line',true);\n\t\t\tlines\n\t\t\t\t.attr('d',function(d){\n\t\t\t\t\tvar source = {},\n\t\t\t\t\t\t\ttarget = {};\n\t\t\t\t\tvar p_1 = d.PlaceID || d.PlaceID_End,\n\t\t\t\t\t\t\tp_2 = d.PlaceID_End || d.PlaceID;\n\n\t\t\t\t\t//isolate x and y start coordinates using projection\n\t\t\t\t\tsource = projection([\n\t\t\t\t\t\tself.places[p_1].Long,\n\t\t\t\t\t\tself.places[p_1].Lat\n\t\t\t\t\t]);\n\t\t\t\t\t// if(!self.places[p_2]){debugger;}\n\t\t\t\t\t//isolate x and y end coordinates using projection\n\t\t\t\t\ttarget = projection([\n\t\t\t\t\t\tself.places[p_2].Long,\n\t\t\t\t\t\tself.places[p_2].Lat\n\t\t\t\t\t]);\n\n\t\t\t\t\t//this is a path builder -- creates a curved line between points\n\t\t\t\t\t//src: http://stackoverflow.com/questions/13455510/curved-line-on-d3-force-directed-tree\n\t\t\t\t\tvar dx = target[0] -source[0],\n\t\t\t\t\t\t\tdy = target[1] -source[1],\n\t\t\t\t\t\t\tdr = Math.sqrt((dx +d.tier) * (dx +d.tier) + (dy +d.tier) * (dy +d.tier));\n\t\t\t\t\treturn 'M' + source[0] + ',' + source[1] + 'A' + dr + ',' + dr + ' 0 0,1 ' + target[0] + ',' + target[1];\n\t\t\t\t});\n\t\t\tlines.exit().remove();\n\t\t}\n\n\t\tfunction generate_points(){\n\n\t\t\t//scale for radii\n\t\t\tvar r_scale = d3.scale.linear()\n\t\t\t\t.domain([0,10])\n\t\t\t\t.range([0,36]);\n\n\t\t\tpoints_target = self.svg.selectAll('g.points_target')\n\t\t\t\t.data([self]);\n\t\t\tpoints_target.enter().append('g')\n\t\t\t\t.classed('points_target',true);\n\t\t\tpoints_target.exit().remove();\n\n\t\t\tpoints_g = self.svg.selectAll('g.points_g')\n\t\t\t\t.data(d3.entries(intersections));\n\t\t\tpoints_g.enter().append('g')\n\t\t\t\t.classed('points_g',true);\n\t\t\tpoints_g\n\t\t\t\t.attr('transform',function(d){\n\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\tself.places[d.key].Long,\n\t\t\t\t\t\t\t\tself.places[d.key].Lat\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\treturn 'translate(' +px +',' +py +')';\n\t\t\t\t});\n\t\t\tpoints_g\n\t\t\t\t.on('mousemove',function(d){\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.transition()\n\t\t\t\t\t\t.duration(self.ttime)\n\t\t\t\t\t\t.attr('transform',function(_d){\n\t\t\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1.5)';\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on('mouseout',function(d){\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.transition()\n\t\t\t\t\t\t.duration(self.ttime/2)\n\t\t\t\t\t\t.attr('transform',function(_d){\n\t\t\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1)';\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on('click',function(d){\n\t\t\t\t\td3.event.stopPropagation();\n\t\t\t\t\tunfocus();\n\t\t\t\t\tif(d.key !== focus.key){\n\t\t\t\t\t\tfocus = d;\n\t\t\t\t\t\td3.select(this).classed('focus_point',true);\n\t\t\t\t\t}\n\t\t\t\t\tgenerate_sidebar();\n\t\t\t\t});\n\t\t\tpoints_g.exit().remove();\n\n\t\t\t//circlebacks (most certain size)\n\t\t\tpoints_backs = points_g.selectAll('circle.point_back')\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\n\t\t\tpoints_backs.enter().append('circle')\n\t\t\t\t.classed('point_back',true);\n\t\t\tpoints_backs\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_backs.exit().remove();\n\n\t\t\t//least certain\n\t\t\tpoints_01 = points_g.selectAll('circle.point_01')\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\n\t\t\tpoints_01.enter().append('circle')\n\t\t\t\t.classed('point_01',true);\n\t\t\tpoints_01\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_01.exit().remove();\n\t\t\t\t\n\t\t\t//certain\n\t\t\tpoints_02 = points_g.selectAll('circle.point_02')\n\t\t\t\t.data(function(d){ return [d.value.lists._02]; });\n\t\t\tpoints_02.enter().append('circle')\n\t\t\t\t.classed('point_02',true);\n\t\t\tpoints_02\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){ \n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_02.exit().remove();\n\t\t\t\t\n\t\t\t//most certain\n\t\t\tpoints_03 = points_g.selectAll('circle.point_03')\n\t\t\t\t.data(function(d){ return [d.value.lists._03]; });\n\t\t\tpoints_03.enter().append('circle')\n\t\t\t\t.classed('point_03',true);\n\t\t\tpoints_03\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_03.exit().remove();\n\t\t}\n\n\t\tfunction generate_sidebar(){\n\t\t\tvar o_scale = d3.scale.linear()\n\t\t\t\t.domain([0,3])\n\t\t\t\t.range([0.5,1]);\n\n\t\t\tif(focus){\n\t\t\t\td3.select('#sidebar_title').html('&#8618;&nbsp;' +self.places[focus.key].PlaceName);\n\n\t\t\t\tvar data = sidebar_mode === 1 ? (intersections_unique[focus.key] || []) : (trajectories_unique[focus.key]);\n\t\t\t\tvar items_target = d3.select('#sidebar_items');\n\t\t\t\tvar items,\n\t\t\t\t\t\titems_date;\n\n\t\t\t\titems = items_target.selectAll('li.item')\n\t\t\t\t\t.data(data);\n\t\t\t\titems.enter().append('li')\n\t\t\t\t\t.classed('item',true);\n\t\t\t\titems\n\t\t\t\t\t.attr('class',function(d){\n\t\t\t\t\t\tvar idx = d3.keys(self.authors).indexOf(d.AuthorID);\n\t\t\t\t\t\treturn 'item id_' +idx;\n\t\t\t\t\t})\n\t\t\t\t\t.style('opacity',function(d){\n\t\t\t\t\t\treturn o_scale(d.Likelihood);\n\t\t\t\t\t})\n\t\t\t\t\t.html(function(d){\n\t\t\t\t\t\treturn self.authors[d.AuthorID];\n\t\t\t\t\t});\n\t\t\t\titems.exit().remove();\n\n\t\t\t\titems_date = items.selectAll('div.item_date')\n\t\t\t\t\t.data(function(d){ return [d]; });\n\t\t\t\titems_date.enter().append('div')\n\t\t\t\t\t.classed('item_date',true);\n\t\t\t\titems_date\n\t\t\t\t\t.html(function(d){\n\t\t\t\t\t\tvar str;\n\t\t\t\t\t\tif(sidebar_mode === 1){\n\t\t\t\t\t\t\tstr = d.StartDate && d.EndDate ? d.StartDate +'&nbsp;&ndash;&nbsp;' +d.EndDate : d.StartDate ? d.StartDate +'&nbsp;&ndash;' : d.EndDate ? '&nbsp;&ndash;' +d.EndDate : '';\n\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\tvar a1 = d.PlaceID === focus.key ? 'accent' : '',\n\t\t\t\t\t\t\t\t\ta2 = d.PlaceID_End && d.PlaceID_End === focus.key ? 'accent' : '';\n\t\t\t\t\t\t\tvar p1 = '<span class=\"_' +d.Likelihood +' ' +a1 +'\">' +self.places[d.PlaceID].PlaceName +'</span>',\n\t\t\t\t\t\t\t\t\tp2 = '<span class=\"_' +d.Likelihood_End +' ' +a2 +'\">' +(d.PlaceID_End ? self.places[d.PlaceID_End].PlaceName : '') +'</span>';\n\t\t\t\t\t\t\tstr = '<div class=\"b\">' +(d.EndDate || '') +'</div><div>' +p1 +'&nbsp;&rarr;&nbsp;' +p2 +'</div>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str;\n\t\t\t\t\t});\n\t\t\t\titems_date.exit().remove();\n\n\t\t\t} else{\n\t\t\t\td3.select('#sidebar_title').html('');\n\t\t\t\td3.select('#sidebar_items').html('');\n\t\t\t}\n\t\t}\n\n\t\tfunction update_datebar(){\n\t\t\tvar f = d3.time.format('%b. %Y');\n\t\t\td3.select('#date_start').html(f(self.date_start));\n\t\t\td3.select('#date_end').html(f(self.date_end));\n\t\t}\n\n\t\tfunction update(){\n\t\t\tfilter_data();\n\t\t\tgenerate_lines();\n\t\t\tgenerate_points();\n\t\t\tgenerate_sidebar();\n\t\t}\n\n\t\tfunction unfocus(){\n\t\t\tfocus = false;\n\t\t\td3.selectAll('.focus_point').classed('focus_point',false);\n\t\t}\n\n\t\tfilter_data();\n\t\tgenerate_lines();\n\t\tgenerate_points();\n\t\tgenerate_sidebar();\n\t}\n\n\tgenerate_routes(){\n\t\tvar self = this;\n\t\tvar visH = this.height*6;\n\t\tthis.svg.attr('height',visH);\n\n\t\t//translate days to distance\n\t\tvar routes_scale = d3.time.scale()\n\t\t\t\t.domain(this.range)\n\t\t\t\t.range([0,visH -150 -60]);\n\t\tvar routes_g,\n\t\t\t\troutes_lines_bknd,\n\t\t\t\troutes_labels,\n\t\t\t\troutes_lines,\n\t\t\t\troutes_stops,\n\t\t\t\troutes_points,\n\t\t\t\troutes_points_labels;\n\t\tvar routes_rad = 3;\n\n\t\t//reset range of scale to fit selection\n\t\tvar starts = [],\n\t\t\t\tends = [];\n\t\td3.keys(self.itineraries).forEach(function(d){\n\t\t\tstarts.push(d3.min(self.itineraries[d],function(_d){return (new Date(_d.StartDate));}));\n\t\t\t// ends.push(d3.max(self.itineraries[d],function(_d){return (new Date(_d.EndDate));}));\n\t\t});\n\t\troutes_scale.domain([\n\t\t\td3.min(starts,function(d){return d;}),\n\t\t\tthis.range[1]\n\t\t\t// d3.max(ends,function(d){return d;})\n\t\t]);\n\n\t\t//route countainers\n\t\troutes_g = this.svg.selectAll('g.routes_g')\n\t\t\t.data(d3.keys(self.itineraries));\n\t\troutes_g.enter().append('g')\n\t\t\t.classed('routes_g',true);\n\t\troutes_g\n\t\t\t.attr('class',function(d){\n\t\t\t\treturn 'routes_g id_' +d3.keys(self.authors).indexOf(d);\n\t\t\t})\n\t\t\t.attr('transform',function(d,i){\n\t\t\t\tvar x = i*(self.width/2),\n\t\t\t\t\t\ty = 150;\n\t\t\t\treturn 'translate(' +x +',' +y +')';\n\t\t\t});\n\t\troutes_g.exit().remove();\n\n\t\t//background lines\n\t\troutes_lines_bknd = routes_g.selectAll('line.routes_lines_bknd')\n\t\t\t.data(function(d){ return self.itineraries[d]; });\n\t\troutes_lines_bknd.enter().append('line')\n\t\t\t.classed('routes_lines_bknd',true);\n\t\troutes_lines_bknd\n\t\t\t.attr('x1',self.width/4)\n\t\t\t.attr('y1',function(d,i){\n\t\t\t\treturn routes_scale(routes_scale.domain()[0]);\n\t\t\t})\n\t\t\t.attr('x2',self.width/4)\n\t\t\t.attr('y2',function(d,i){\n\t\t\t\treturn routes_scale(routes_scale.domain()[1]);\n\t\t\t});\n\t\troutes_lines_bknd.exit().remove();\n\n\t\t//names\n\t\troutes_labels = routes_g.selectAll('text.routes_labels')\n\t\t\t.data(function(d){ return [d]; });\n\t\troutes_labels.enter().append('text')\n\t\t\t.classed('routes_labels',true);\n\t\troutes_labels\n\t\t\t.attr('x',self.width/4)\n\t\t\t.attr('y',-30)\n\t\t\t.text(function(d){ return self.authors[d]; });\n\t\troutes_labels.exit().remove();\n\n\t\t//lines\n\t\troutes_lines = routes_g.selectAll('line.routes_lines')\n\t\t\t.data(function(d){ return self.itineraries[d]; });\n\t\troutes_lines.enter().append('line')\n\t\t\t.classed('routes_lines',true);\n\t\troutes_lines\n\t\t\t.attr('class',function(d){\n\t\t\t\treturn 'routes_lines id_' +d3.keys(self.authors).indexOf(d.AuthorID);\n\t\t\t})\n\t\t\t.attr('x1',self.width/4)\n\t\t\t.attr('y1',function(d,i){\n\t\t\t\treturn d.StartDate ? routes_scale(new Date(d.StartDate)) : routes_scale(new Date(d.EndDate));\n\t\t\t})\n\t\t\t.attr('x2',self.width/4)\n\t\t\t.attr('y2',function(d,i){\n\t\t\t\treturn d.EndDate ? routes_scale(new Date(d.EndDate)) : routes_scale(new Date(d.StartDate));\n\t\t\t});\n\t\troutes_lines.exit().remove();\n\n\t\t//pointers\n\t\troutes_points = routes_g.selectAll('line.routes_points')\n\t\t\t.data(function(d){ return self.itineraries[d]; });\n\t\troutes_points.enter().append('line')\n\t\t\t.classed('routes_points',true);\n\t\troutes_points\n\t\t\t.attr('x1',self.width/4 -15)\n\t\t\t.attr('y1',function(d,i){\n\t\t\t\treturn d.StartDate ? routes_scale(new Date(d.StartDate)) : routes_scale(new Date(d.EndDate));\n\t\t\t})\n\t\t\t.attr('x2',self.width/4 +45)\n\t\t\t.attr('y2',function(d,i){\n\t\t\t\treturn d.StartDate ? routes_scale(new Date(d.StartDate)) : routes_scale(new Date(d.EndDate));\n\t\t\t});\n\t\troutes_points.exit().remove();\n\n\t\t//stops\n\t\troutes_stops = routes_g.selectAll('circle.routes_stops')\n\t\t\t.data(function(d){ return self.itineraries[d]; });\n\t\troutes_stops.enter().append('circle')\n\t\t\t.classed('routes_stops',true);\n\t\troutes_stops\n\t\t\t.attr('cx',self.width/4 +45)\n\t\t\t.attr('cy',function(d,i){\n\t\t\t\treturn d.StartDate ? routes_scale(new Date(d.StartDate)) : routes_scale(new Date(d.EndDate));\n\t\t\t})\n\t\t\t.attr('r',routes_rad);\n\t\troutes_stops.exit().remove();\n\n\t\t//points labels\n\t\troutes_points_labels = routes_g.selectAll('text.routes_points_labels')\n\t\t\t.data(function(d){ return self.itineraries[d]; });\n\t\troutes_points_labels.enter().append('text')\n\t\t\t.classed('routes_points_labels',true);\n\t\troutes_points_labels\n\t\t\t.attr('x',self.width/4 +60)\n\t\t\t.attr('y',function(d,i){\n\t\t\t\treturn (d.StartDate ? routes_scale(new Date(d.StartDate)) : routes_scale(new Date(d.EndDate))) +4;\n\t\t\t})\n\t\t\t.text(function(d){\n\t\t\t\tvar t1 = d.StartDate || 'Unknown',\n\t\t\t\t\t\tt2 = d.EndDate || 'Unknown';\n\t\t\t\treturn self.places[d.PlaceID].PlaceName + ' (' +t1 +' to ' +t2 +')';\n\t\t\t});\n\t\troutes_points_labels.exit().remove();\n\t}\n\n\tswitch_mode(_id){\n\t\tthis.mode = _id;\n\t\tthis.tear_down();\n\t\tif(this.mode === 1){\n\t\t\tthis.generate_map();\n\t\t} else{\n\t\t\tthis.generate_routes();\n\t\t}\n\t}\n\n\ttear_down(){\n\t\tvar opp = this.mode === 1 ? 2 : 1;\n\t\t\n\t\tthis.svg.selectAll(\"*\").remove();\n\t\td3.select('#slider .slider_body').selectAll('*').remove();\n\t\t\n\t\td3.selectAll('.sidebar_tab.selected').classed('selected',false);\n\t\td3.select('.sidebar_tab#sidebar_01').classed('selected',true);\n\n\t\td3.selectAll('._0' +opp).style('display','none');\n\t\td3.selectAll('._0' +this.mode).style('display','block');\n\n\t\tthis.date_start = this.range[0];\n\t\tthis.date_end = this.range[1];\n\t}\n}\n\nvar vis = new CreateMap();\nvis.get_data();\n\n//custom sub-selections\nd3.selection.prototype.first = function() {\n  return d3.select(this[0][0]);\n};\nd3.selection.prototype.last = function() {\n  var last = this.size() - 1;\n  return d3.select(this[0][last]);\n};\n"]}