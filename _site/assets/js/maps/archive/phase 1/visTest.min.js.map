{"version":3,"sources":["archive/phase 1/visTest.js"],"names":["CreateMap","[object Object]","this","data","itineraries","trajectories","intersections","places","authors","author_names","continents","width","window","innerWidth","height","innerHeight","loading","range","Date","date_start","date_end","mode","d3","select","classed","ttime","_elem","filter","d","length","process_data","setup","generate","self","datasets","forEach","push","filepath","json","e","_d","loading_manager","keys","k","split","trim","join","toLowerCase","PlaceName","author_ids","AuthorID","tabs","selectAll","svg","append","attr","on","route_change","enter","text","left_svg","right_svg","elem","id","switch_mode","tear_down","generate_map","generate_routes","focus","sidebar_tabs","sidebar_mode","event","stopPropagation","unfocus","generate_sidebar","scale","time","domain","scale_axis","axis","orient","ticks","tickSize","tickPadding","slide","slider","value","scale_value_converter","orientation","margin","animate","evt","v_1","v_2","update_datebar","update","_val","s","nice","month","invert","call","last","style","intersections_unique","trajectories_unique","points_target","points_g","points_backs","points_03","points_02","points_01","lines_target","lines_g","lines","map","projection","geo","mercator","translate","path","features","topojson","feature","objects","filter_data","holder","entries","n","key","figures","__d","Likelihood","lists","_01","values","_02","_03","t","EndDate","PlaceID","tier","i","j","PlaceID_End","Likelihood_End","generate_lines","exit","remove","indexOf","source","target","p_1","p_2","Long","Lat","dx","dy","dr","Math","sqrt","generate_points","r_scale","linear","p","transition","duration","r_tot","parentNode","__data__","o_scale","html","items","items_date","str","StartDate","a1","a2","p1","p2","f","format","_side","curr_svg","author_name","property","author_id","visH","starts","ends","min","max","earliest_date","latest_date","route_scale","route_g","route_line_background","route_labels","route_line","route_points","route_stops","route_point_labels","t1","t2","_id","opp","vis","get_data","selection","prototype","first","size"],"mappings":"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","file":"../../../archive/phase 1/visTest.min.js","sourcesContent":["class CreateMap {\n\t\n\tconstructor(){\n\t\tthis.data = {};\n\n\t\tthis.itineraries = {};\n\t\tthis.trajectories = {};\n\t\tthis.intersections = {};\n\t\tthis.places = {};\n\t\tthis.authors = {};  // {author_id: author_name}\n        this.author_names = {}; // {author_name: author_id}\n\t\tthis.continents = {};\n\n\t\t//store screen height and width\n\t\tthis.width = window.innerWidth;\n\t\tthis.height = window.innerHeight;\n\n\t\tthis.loading = [];\n\n\t\tthis.range = [\n\t\t\tnew Date(1890,1,1),\n\t\t\tnew Date(2010,1,1)\n\t\t];\n\t\tthis.date_start = this.range[0];\n\t\tthis.date_end = this.range[1];\n\n\t\tthis.mode = d3.select('#_01').classed('selected') ? 1 : 2;\n\n\t\tthis.ttime = 45;\n\t}\n\n\tloading_manager(_elem){\n\t\tvar self = this;\n\t\tvar empty = false;\n\n\t\t//remove name of retrieved JSON document from loading array\n\t\tself.loading = self.loading.filter(function(d){ return d !== _elem; });\n\n\t\tif(self.loading.length === 0){\n\t\t\tself.process_data();\n\t\t\tself.setup();\n\t\t\tself.generate();\n\t\t}\n\t}\n\n\tget_data(){\n\t\tvar self = this;\n\t\tvar datasets = ['author_ids','intersections','itineraries','places','continents'];\n\n\t\tdatasets.forEach(function(d){ self.loading.push(d); });\n\t\tdatasets.forEach(function(d){\n\n\t\t\tvar filepath = 'data/three_' +d +'.json';\n\n\t\t\td3.json(filepath,function(e,_d){\n\t\t\t\tif(!e){\n\t\t\t\t\tself.data[d] = _d;\n\t\t\t\t\tself.loading_manager(d);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprocess_data(){\n\t\tvar self = this;\n\t\t\n\t\tself.continents = self.data.continents;\n\n\t\t//WEAKPOINT ** fix later\n\t\t//places\n\t\td3.keys(self.data.places).forEach(function(d){\n\t\t\tvar k = d.split(',');\n\t\t\tk[0] = k[0].trim().split(' ').join('-');\n\t\t\tk[1] = k[1].trim().split(' ').join('-');\n\t\t\tk = k.join('_').toLowerCase();\n\t\t\tself.places[k] = self.data.places[d];\n\t\t\tself.places[k].PlaceName = d;\n\t\t});\n\n\t\t//authors\n\t\td3.keys(self.data.author_ids).forEach(function(k){\n\t\t\tself.authors[self.data.author_ids[k]] = k;\n            self.author_names[k] = self.data.author_ids[k];\n\t\t});\n\n\t\t//intersections\n\t\tself.intersections = self.data.intersections;\n\n\t\t//trajectories\n\t\tself.trajectories = {};\n\n\t\t//itineraries\n\t\tself.itineraries = {};\n\t\td3.keys(self.authors).forEach(function(d){\n\t\t\tif(!self.itineraries[d]){ self.itineraries[d] = []; }\n\t\t});\n\t\td3.keys(self.data.itineraries).forEach(function(d){\n\t\t\tself.data.itineraries[d].forEach(function(_d){\n\t\t\t\tself.itineraries[_d.AuthorID].push(_d);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetup(){\n\t\tvar self = this;\n\t\tvar tabs = d3.selectAll('.tab');\n\n\t\tthis.svg = d3.select('#container')\n\t\t\t.append('svg')\n\t\t\t.attr('width',this.width);\n\n        // Create left figure drop-down selector\n        d3.select('#left_itinerary')\n            .append('select')\n            .attr('id','left_select')\n            .on('change', function(){ self.route_change('left'); })\n            .selectAll('option')\n            .data(d3.keys(self.author_names)).enter()\n            .append('option')\n            .text(function (d) { return d; });\n\n        // Create right figure drop-down selector\n        d3.select('#right_itinerary')\n            .append('select')\n            .attr('id', 'right_select')\n            .on('change', function(){ self.route_change('right'); })\n            .selectAll('option')\n            .data(d3.keys(self.author_names)).enter()\n            .append('option')\n            .text(function (d) { return d; });\n\n        // Create left div for figure route\n        this.left_svg = d3.select('#left_itinerary')\n            .append('svg') //WAS \"DIV\"\n            .attr('id', 'left_route');\n\n        // Create right div for figure route\n        this.right_svg = d3.select('#right_itinerary')\n            .append('svg') //WAS \"DIV\"\n            .attr('id', 'right_route');\n\n        // Update left route and right route to show route for current figure\n        self.route_change('left');\n        self.route_change('right');\n\n        tabs.on('click',function(d){\n\t\t\tvar elem = d3.select(this),\n\t\t\t\t\tid = +elem.attr('id').split('_')[1];\n\t\t\t\n\t\t\tself.switch_mode(id);\n\n\t\t\ttabs.classed('selected',false);\n\t\t\telem.classed('selected',true);\n\t\t});\n\t}\n\n\tgenerate(){\n\t    this.tear_down();\n\t\tif(this.mode === 1){\n\t\t\tthis.generate_map();\n\t\t} else{\n\t\t\tthis.generate_routes();\n\t\t}\n\t}\n\n\tgenerate_map(){\n\t\tvar self = this;\n\t\tvar focus = false;\n\t\tvar sidebar_tabs = d3.selectAll('.sidebar_tab'),\n\t\t\t\tsidebar_mode = 1;\n\n\t\tthis.svg.attr('height',this.height);\n\n\t\t//click handlers\n\t\tself.svg.on('click',function(d){\n\t\t\td3.event.stopPropagation();\n\t\t\tunfocus();\n\t\t\tgenerate_sidebar();\n\t\t});\n\t\tsidebar_tabs.on('click',function(d){\n\t\t\tvar elem = d3.select(this);\n\t\t\tsidebar_tabs.classed('selected',false);\n\t\t\telem.classed('selected',true);\n\t\t\tsidebar_mode = +elem.attr('id').split('_')[1];\n\t\t\tgenerate_sidebar();\n\t\t});\n\n\t\t//slider\n\t\tvar scale = d3.time.scale()\n\t\t\t.domain(this.range);\n\t\tvar scale_axis = d3.svg.axis()\n\t\t\t.orient('right')\n\t\t\t.ticks(20)\n\t\t\t.tickSize(30)\n\t\t\t.tickPadding(12);\n\t\tvar slide = d3.slider()\n\t\t\t.scale(scale)\n\t\t\t.axis(scale_axis)\n\t\t\t.value([\n\t\t\t\tscale_value_converter(this.range[1]),\n\t\t\t\tscale_value_converter(this.range[0])\n\t\t\t])\n\t\t\t.orientation('vertical')\n\t\t\t.margin(0)\n\t\t\t.animate(false)\n\t\t\t.on('slide',function(evt,value){\n\t\t\t\tvar v_1 = value[1] instanceof Date ? value[1] : new Date(value[1]),\n\t\t\t\t\t\tv_2 = value[0] instanceof Date ? value[0] : new Date(value[0]);\n\t\t\t\t\n\t\t\t\tself.date_start = scale_value_converter(v_1);\n\t\t\t\tself.date_end = scale_value_converter(v_2);\n\n\t\t\t\t// unfocus();\n\t\t\t\tupdate_datebar();\n\t\t\t\tupdate();\n\t\t\t})\n\t\t\t.on('slideend',function(evt,value){\n\t\t\t\tupdate();\n\t\t\t});\n\n\t\t//the slider library, though lightweight, is flawed\n\t\t//use this to convert the date values properly\n\t\tfunction scale_value_converter(_val){\n\t\t\tvar s = d3.time.scale()\n\t\t\t\t.domain(scale.domain())\n\t\t\t\t.range([0,self.height])\n\t\t\t\t.nice(d3.time.month)\n\t\t\t\t;\n\t\t\treturn s.invert((self.height -(s(_val))));\n\t\t}\n\n\t\tvar slider = d3.select('#slider .slider_body').call(slide);\n\t\td3.selectAll('#slider .slider_body .tick').last().style('display','none');\n\t\t\n\t\tupdate_datebar();\n\n\t\t//map\n\t\tvar projection = d3.geo.mercator()\n\t\t\t.scale(200)\n\t\t\t.translate([self.width*0.5,self.height*0.65])\n\t\t\t;\n\t\tvar path = d3.geo.path().projection(projection);\n\n\t\tvar features = topojson.feature(self.continents,self.continents.objects.continents);\n\t\tvar intersections,\n\t\t\t\tintersections_unique,\n\t\t\t\ttrajectories,\n\t\t\t\ttrajectories_unique;\n\t\tvar points_target,\n\t\t\t\tpoints_g,\n\t\t\t\tpoints_backs,\n\t\t\t\tpoints_03,\n\t\t\t\tpoints_02,\n\t\t\t\tpoints_01,\n\n\t\t\t\tlines_target,\n\t\t\t\tlines_g,\n\t\t\t\tlines;\n\n\t\t//draw vector map\n\t\tvar map;\n\t\tmap = self.svg.selectAll('path.map')\n\t\t\t.data([features]);\n\t\tmap.enter().append('path')\n\t\t\t.classed('map',true);\n\t\tmap\n\t\t\t.attr('d',path)\n\t\t\t;\n\t\tmap.exit().remove();\n\n\t\tfunction filter_data(){\n\n\t\t\t//clear objects\n\t\t\tintersections = {};\n\t\t\tintersections_unique = {};\n\t\t\ttrajectories = {};\n\t\t\ttrajectories_unique = {};\n\n\t\t\t//INTERSECTIONS\n\t\t\t//filter by date range\n\t\t\tvar holder = d3.entries(self.intersections).filter(function(d){\n\t\t\t\tvar n = new Date(d.key);\n\t\t\t\treturn n >=self.date_start && n <=self.date_end;\n\t\t\t});\n\t\t\t//get distinct places\n\t\t\t//slot author IDs into place\n\t\t\t//highest likelihood score wins\n\t\t\tholder.forEach(function(d){\n\t\t\t\tif(d3.keys(d.value).length >0){\n\t\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\t\tif(!intersections[_d]){ \n\t\t\t\t\t\t\tintersections[_d] = {}; \n\t\t\t\t\t\t\tintersections[_d].figures = {}; \n\t\t\t\t\t\t}\n\t\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\t\tif(!intersections[_d].figures[__d.AuthorID] || intersections[_d].figures[__d.AuthorID] >__d.Likelihood){\n\t\t\t\t\t\t\t\tintersections[_d].figures[__d.AuthorID] = __d.Likelihood;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\t//tally up totals\n\t\t\td3.keys(intersections).forEach(function(d){\n\t\t\t\tintersections[d].lists = {};\n\t\t\t\tintersections[d].lists._01 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 1; });\n\t\t\t\tintersections[d].lists._02 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 2; });\n\t\t\t\tintersections[d].lists._03 = d3.values(intersections[d].figures).filter(function(_d){ return _d === 3; });\n\t\t\t});\n\t\t\t//make list of unique intersections per place\n\t\t\tholder.forEach(function(d){\n\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\tif(!intersections_unique[_d]){ intersections_unique[_d] = []; }\n\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\tif(intersections_unique[_d].filter(function(t){ return t.AuthorID === __d.AuthorID && t.EndDate === __d.EndDate; }).length === 0){\n\t\t\t\t\t\t\tintersections_unique[_d].push(__d);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t//TRAJECTORIES\n\t\t\tholder.forEach(function(d){\n\t\t\t\td3.keys(d.value).forEach(function(_d){\n\t\t\t\t\td.value[_d].forEach(function(__d){\n\t\t\t\t\t\tif(!trajectories[__d.AuthorID]){ trajectories[__d.AuthorID] = []; }\n\t\t\t\t\t\tif(trajectories[__d.AuthorID].filter(function(t){ return t.PlaceID === __d.PlaceID && t.EndDate === __d.EndDate; }).length === 0){\n\t\t\t\t\t\t\ttrajectories[__d.AuthorID].push(__d);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t\t//pair up start and end points\n\t\t\tvar tier = 0;\n\t\t\tfor(var i=0; i<d3.keys(trajectories).length; i++){\n\t\t\t\tfor(var j=0; j<trajectories[d3.keys(trajectories)[i]].length -1; j++){\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].PlaceID_End = trajectories[d3.keys(trajectories)[i]][j+1].PlaceID;\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].Likelihood_End = trajectories[d3.keys(trajectories)[i]][j+1].Likelihood;\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].tier = tier;\n\t\t\t\t\ttier=(j%2)*10;\n\t\t\t\t} \n\t\t\t}\n\t\t\t//make list of unique trajectories per place\n\t\t\td3.keys(intersections).forEach(function(d){\n\t\t\t\tif(!trajectories_unique[d]){ trajectories_unique[d] = []; }\n\t\t\t});\n\t\t\td3.values(trajectories).forEach(function(d){\n\t\t\t\td.forEach(function(_d){\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID]){ trajectories_unique[_d.PlaceID] = []; }\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID_End]){ trajectories_unique[_d.PlaceID_End] = []; }\n\t\t\t\t\ttrajectories_unique[_d.PlaceID].push(_d);\n\t\t\t\t\tif(_d.PlaceID_End){ trajectories_unique[_d.PlaceID_End].push(_d); }\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfunction generate_lines(){\n\n\t\t\tlines_target = self.svg.selectAll('g.lines_target')\n\t\t\t\t.data([self]);\n\t\t\tlines_target.enter().append('g')\n\t\t\t\t.classed('lines_target',true);\n\t\t\tlines_target.exit().remove();\n\n\t\t\tlines_g = lines_target.selectAll('g.lines_g')\n\t\t\t\t.data(d3.entries(trajectories));\n\t\t\tlines_g.enter().append('g')\n\t\t\t\t.classed('lines_g',true);\n\t\t\tlines_g\n\t\t\t\t.attr('class',function(d){\n\t\t\t\t\treturn 'lines_g id_' +d3.keys(self.authors).indexOf(d.key);\n\t\t\t\t});\n\t\t\tlines_g.exit().remove();\n\n\t\t\tlines = lines_g.selectAll('path.line')\n\t\t\t\t.data(function(d){ return d.value.filter(function(_d){ return _d.PlaceID_End; }); });\n\t\t\tlines.enter().append('path')\n\t\t\t\t.classed('line',true);\n\t\t\tlines\n\t\t\t\t.attr('d',function(d){\n\t\t\t\t\tvar source = {},\n\t\t\t\t\t\t\ttarget = {};\n\t\t\t\t\tvar p_1 = d.PlaceID || d.PlaceID_End,\n\t\t\t\t\t\t\tp_2 = d.PlaceID_End || d.PlaceID;\n\n\t\t\t\t\t//isolate x and y start coordinates using projection\n\t\t\t\t\tsource = projection([\n\t\t\t\t\t\tself.places[p_1].Long,\n\t\t\t\t\t\tself.places[p_1].Lat\n\t\t\t\t\t]);\n\t\t\t\t\t// if(!self.places[p_2]){debugger;}\n\t\t\t\t\t//isolate x and y end coordinates using projection\n\t\t\t\t\ttarget = projection([\n\t\t\t\t\t\tself.places[p_2].Long,\n\t\t\t\t\t\tself.places[p_2].Lat\n\t\t\t\t\t]);\n\n\t\t\t\t\t//this is a path builder -- creates a curved line between points\n\t\t\t\t\t//src: http://stackoverflow.com/questions/13455510/curved-line-on-d3-force-directed-tree\n\t\t\t\t\tvar dx = target[0] -source[0],\n\t\t\t\t\t\t\tdy = target[1] -source[1],\n\t\t\t\t\t\t\tdr = Math.sqrt((dx +d.tier) * (dx +d.tier) + (dy +d.tier) * (dy +d.tier));\n\t\t\t\t\treturn 'M' + source[0] + ',' + source[1] + 'A' + dr + ',' + dr + ' 0 0,1 ' + target[0] + ',' + target[1];\n\t\t\t\t});\n\t\t\tlines.exit().remove();\n\t\t}\n\n\t\tfunction generate_points(){\n\n\t\t\t//scale for radii\n\t\t\tvar r_scale = d3.scale.linear()\n\t\t\t\t.domain([0,10])\n\t\t\t\t.range([0,36]);\n\n\t\t\tpoints_target = self.svg.selectAll('g.points_target')\n\t\t\t\t.data([self]);\n\t\t\tpoints_target.enter().append('g')\n\t\t\t\t.classed('points_target',true);\n\t\t\tpoints_target.exit().remove();\n\n\t\t\tpoints_g = self.svg.selectAll('g.points_g')\n\t\t\t\t.data(d3.entries(intersections));\n\t\t\tpoints_g.enter().append('g')\n\t\t\t\t.classed('points_g',true);\n\t\t\tpoints_g\n\t\t\t\t.attr('transform',function(d){\n\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\tself.places[d.key].Long,\n\t\t\t\t\t\t\t\tself.places[d.key].Lat\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\treturn 'translate(' +px +',' +py +')';\n\t\t\t\t});\n\t\t\tpoints_g\n\t\t\t\t.on('mousemove',function(d){\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.transition()\n\t\t\t\t\t\t.duration(self.ttime)\n\t\t\t\t\t\t.attr('transform',function(_d){\n\t\t\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1.5)';\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on('mouseout',function(d){\n\t\t\t\t\td3.select(this)\n\t\t\t\t\t\t.transition()\n\t\t\t\t\t\t.duration(self.ttime/2)\n\t\t\t\t\t\t.attr('transform',function(_d){\n\t\t\t\t\t\t\tvar p  = projection([\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\n\t\t\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\t\t\tpx = p[0],\n\t\t\t\t\t\t\t\t\tpy = p[1];\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1)';\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.on('click',function(d){\n\t\t\t\t\td3.event.stopPropagation();\n\t\t\t\t\tunfocus();\n\t\t\t\t\tif(d.key !== focus.key){\n\t\t\t\t\t\tfocus = d;\n\t\t\t\t\t\td3.select(this).classed('focus_point',true);\n\t\t\t\t\t}\n\t\t\t\t\tgenerate_sidebar();\n\t\t\t\t});\n\t\t\tpoints_g.exit().remove();\n\n\t\t\t//circlebacks (most certain size)\n\t\t\tpoints_backs = points_g.selectAll('circle.point_back')\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\n\t\t\tpoints_backs.enter().append('circle')\n\t\t\t\t.classed('point_back',true);\n\t\t\tpoints_backs\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_backs.exit().remove();\n\n\t\t\t//least certain\n\t\t\tpoints_01 = points_g.selectAll('circle.point_01')\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\n\t\t\tpoints_01.enter().append('circle')\n\t\t\t\t.classed('point_01',true);\n\t\t\tpoints_01\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_01.exit().remove();\n\t\t\t\t\n\t\t\t//certain\n\t\t\tpoints_02 = points_g.selectAll('circle.point_02')\n\t\t\t\t.data(function(d){ return [d.value.lists._02]; });\n\t\t\tpoints_02.enter().append('circle')\n\t\t\t\t.classed('point_02',true);\n\t\t\tpoints_02\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){ \n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._03.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_02.exit().remove();\n\t\t\t\t\n\t\t\t//most certain\n\t\t\tpoints_03 = points_g.selectAll('circle.point_03')\n\t\t\t\t.data(function(d){ return [d.value.lists._03]; });\n\t\t\tpoints_03.enter().append('circle')\n\t\t\t\t.classed('point_03',true);\n\t\t\tpoints_03\n\t\t\t\t.classed('point',true)\n\t\t\t\t.attr('cx',0)\n\t\t\t\t.attr('cy',0)\n\t\t\t\t.attr('r',function(d){\n\t\t\t\t\tvar r_tot = d.length;\n\t\t\t\t\treturn r_scale(r_tot);\n\t\t\t\t});\n\t\t\tpoints_03.exit().remove();\n\t\t}\n\n\t\tfunction generate_sidebar(){\n\t\t\tvar o_scale = d3.scale.linear()\n\t\t\t\t.domain([0,3])\n\t\t\t\t.range([0.5,1]);\n\n\t\t\tif(focus){\n\t\t\t\td3.select('#sidebar_title').html('&#8618;&nbsp;' +self.places[focus.key].PlaceName);\n\n\t\t\t\tvar data = sidebar_mode === 1 ? (intersections_unique[focus.key] || []) : (trajectories_unique[focus.key]);\n\t\t\t\tvar items_target = d3.select('#sidebar_items');\n\t\t\t\tvar items,\n\t\t\t\t\t\titems_date;\n\n\t\t\t\titems = items_target.selectAll('li.item')\n\t\t\t\t\t.data(data);\n\t\t\t\titems.enter().append('li')\n\t\t\t\t\t.classed('item',true);\n\t\t\t\titems\n\t\t\t\t\t.attr('class',function(d){\n\t\t\t\t\t\tvar idx = d3.keys(self.authors).indexOf(d.AuthorID);\n\t\t\t\t\t\treturn 'item id_' +idx;\n\t\t\t\t\t})\n\t\t\t\t\t.style('opacity',function(d){\n\t\t\t\t\t\treturn o_scale(d.Likelihood);\n\t\t\t\t\t})\n\t\t\t\t\t.html(function(d){\n\t\t\t\t\t\treturn self.authors[d.AuthorID];\n\t\t\t\t\t});\n\t\t\t\titems.exit().remove();\n\n\t\t\t\titems_date = items.selectAll('div.item_date')\n\t\t\t\t\t.data(function(d){ return [d]; });\n\t\t\t\titems_date.enter().append('div')\n\t\t\t\t\t.classed('item_date',true);\n\t\t\t\titems_date\n\t\t\t\t\t.html(function(d){\n\t\t\t\t\t\tvar str;\n\t\t\t\t\t\tif(sidebar_mode === 1){\n\t\t\t\t\t\t\tstr = d.StartDate && d.EndDate ? d.StartDate +'&nbsp;&ndash;&nbsp;' +d.EndDate : d.StartDate ? d.StartDate +'&nbsp;&ndash;' : d.EndDate ? '&nbsp;&ndash;' +d.EndDate : '';\n\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\tvar a1 = d.PlaceID === focus.key ? 'accent' : '',\n\t\t\t\t\t\t\t\t\ta2 = d.PlaceID_End && d.PlaceID_End === focus.key ? 'accent' : '';\n\t\t\t\t\t\t\tvar p1 = '<span class=\"_' +d.Likelihood +' ' +a1 +'\">' +self.places[d.PlaceID].PlaceName +'</span>',\n\t\t\t\t\t\t\t\t\tp2 = '<span class=\"_' +d.Likelihood_End +' ' +a2 +'\">' +(d.PlaceID_End ? self.places[d.PlaceID_End].PlaceName : '') +'</span>';\n\t\t\t\t\t\t\tstr = '<div class=\"b\">' +(d.EndDate || '') +'</div><div>' +p1 +'&nbsp;&rarr;&nbsp;' +p2 +'</div>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str;\n\t\t\t\t\t});\n\t\t\t\titems_date.exit().remove();\n\n\t\t\t} else{\n\t\t\t\td3.select('#sidebar_title').html('');\n\t\t\t\td3.select('#sidebar_items').html('');\n\t\t\t}\n\t\t}\n\n\t\tfunction update_datebar(){\n\t\t\tvar f = d3.time.format('%b. %Y');\n\t\t\td3.select('#date_start').html(f(self.date_start));\n\t\t\td3.select('#date_end').html(f(self.date_end));\n\t\t}\n\n\t\tfunction update(){\n\t\t\tfilter_data();\n\t\t\tgenerate_lines();\n\t\t\tgenerate_points();\n\t\t\tgenerate_sidebar();\n\t\t}\n\n\t\tfunction unfocus(){\n\t\t\tfocus = false;\n\t\t\td3.selectAll('.focus_point').classed('focus_point',false);\n\t\t}\n\n\t\tfilter_data();\n\t\tgenerate_lines();\n\t\tgenerate_points();\n\t\tgenerate_sidebar();\n\t}\n\n    route_change(_side){\n        var author_name = d3.select('#'+_side+'_select').property('value');\n        var author_id = this.author_names[author_name];\n\n        var curr_svg;\n        if(_side == 'left'){ curr_svg = this.left_svg; }\n        else { curr_svg = this.right_svg; }\n\n        var self = this;\n        var visH = this.height*6;\n        curr_svg.attr('height', visH);\n\n        // Find the earliest and latest itinerary dates\n        var starts = [], ends = [];\n        d3.keys(self.itineraries).forEach(\n            function(d){\n                starts.push(d3.min(self.itineraries[d], function(_d){ return (new Date(_d.StartDate)); }));\n                ends.push(d3.max(self.itineraries[d], function(_d){ return (new Date(_d.EndDate)); }));\n        });\n\n        var earliest_date = d3.min(starts);\n        var latest_date = d3.max(ends);\n\n        //Translate days to distance\n        var route_scale = d3.time.scale().domain([earliest_date, latest_date]).range([0, visH -150 -60]);\n\n        //Create route container\n        var route_g = curr_svg.selectAll('g.route_g').data(author_id);\n        route_g.enter().append('g').classed('route_g',true);\n        route_g\n            .attr('class', 'route_g author_' + _side)\n            .attr('transform', function(d,i){\n                var x = i*(self.width/2),\n                    y = 150;\n                return 'translate(' + x +',' + y +')';\n            });\n        route_g.exit().remove();\n\n        //Add background line\n        var route_line_background = route_g.selectAll('line.route_line_background')\n            .data(self.itineraries[author_id]);\n        route_line_background.enter().append('line').classed('route_line_background',true);\n        route_line_background\n            .attr('x1',self.width/4)\n            .attr('y1',function(d,i){ return route_scale(route_scale.domain()[0]); })\n            .attr('x2',self.width/4)\n            .attr('y2',function(d,i){ return route_scale(route_scale.domain()[1]); });\n        route_line_background.exit().remove();\n\n        //Add figure name\n        var route_labels = route_g.selectAll('text.route_label').data(author_id);\n        route_labels.enter().append('text').classed('route_label',true);\n        route_labels\n            .attr('x',self.width/4)\n            .attr('y',-30)\n            .text(author_name);\n        route_labels.exit().remove();\n\n        //Lines\n        var route_line = route_g.selectAll('line.route_line').data(self.itineraries[author_id]);\n        route_line.enter().append('line').classed('route_line',true);\n        route_line\n            .attr('class', 'route_line author_' + _side)\n            .attr('x1',self.width/4)\n            .attr('y1',function(d, i){\n                return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\n            })\n            .attr('x2',self.width/4)\n            .attr('y2',function(d, i){\n                return d.EndDate ? route_scale(new Date(d.EndDate)) : route_scale(new Date(d.StartDate));\n            });\n        route_line.exit().remove();\n\n        //Points\n        var route_points = route_g.selectAll('line.route_points').data(self.itineraries[author_id]);\n        route_points.enter().append('line').classed('route_points',true);\n        route_points\n            .attr('x1',self.width/4 -15)\n            .attr('y1',function(d,i){\n                return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\n            })\n            .attr('x2',self.width/4 +45)\n            .attr('y2',function(d,i){\n                return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\n            });\n        route_points.exit().remove();\n\n        //Stops\n        var route_rad = 3;\n        var route_stops = route_g.selectAll('circle.route_stops').data(self.itineraries[author_id]);\n        route_stops.enter().append('circle').classed('route_stops',true);\n        route_stops\n            .attr('cx',self.width/4 +45)\n            .attr('cy',function(d,i){\n                return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\n            })\n            .attr('r',route_rad);\n        route_stops.exit().remove();\n\n        //Point labels\n        var route_point_labels = route_g.selectAll('text.route_point_labels').data(self.itineraries[author_id]);\n        route_point_labels.enter().append('text').classed('route_point_labels',true);\n        route_point_labels\n            .attr('x',self.width/4 +60)\n            .attr('y',function(d,i){\n                return (d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate))) +4;\n            })\n            .text(function(d){\n                var t1 = d.StartDate || 'Unknown',\n                    t2 = d.EndDate || 'Unknown';\n                return self.places[d.PlaceID].PlaceName + ' (' +t1 +' to ' +t2 +')';\n            });\n        route_point_labels.exit().remove();\n\n    }\n\n    generate_routes(){\n        var visH = this.height*6;\n        this.svg.attr('height', visH);\n    }\n\n\tswitch_mode(_id){\n\t\tthis.mode = _id;\n\t\tthis.tear_down();\n\t\tif(this.mode === 1){\n\t\t\tthis.generate_map();\n\t\t} else{\n\t\t\tthis.generate_routes();\n\t\t}\n\t}\n\n\ttear_down(){\n\t\tvar opp = this.mode === 1 ? 2 : 1;\n\t\t\n\t\tthis.svg.selectAll(\"*\").remove();\n\t\td3.select('#slider .slider_body').selectAll('*').remove();\n\t\t\n\t\td3.selectAll('.sidebar_tab.selected').classed('selected',false);\n\t\td3.select('.sidebar_tab#sidebar_01').classed('selected',true);\n\n\t\td3.selectAll('._0' +opp).style('display','none');\n\t\td3.selectAll('._0' +this.mode).style('display','block');\n\n\t\tthis.date_start = this.range[0];\n\t\tthis.date_end = this.range[1];\n\t}\n}\n\nvar vis = new CreateMap();\nvis.get_data();\n\n//custom sub-selections\nd3.selection.prototype.first = function() {\n  return d3.select(this[0][0]);\n};\nd3.selection.prototype.last = function() {\n  var last = this.size() - 1;\n  return d3.select(this[0][last]);\n};\n\n\n// old_routes(){\n\n// }\n"]}