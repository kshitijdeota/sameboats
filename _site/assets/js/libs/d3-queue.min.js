!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.d3=t.d3||{})}(this,function(t){"use strict";var i=[].slice,r={};function n(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function a(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var i=t._ended+t._active,n=t._tasks[i],a=n.length-1,o=n[a];n[a]=e(t,i),--t._waiting,++t._active,n=o.apply(null,n),t._tasks[i]&&(t._tasks[i]=n||r)}}(t)}catch(i){if(t._tasks[t._ended+t._active-1])o(t,i);else if(!t._data)throw i}}function e(t,i){return function(r,n){t._tasks[i]&&(--t._active,++t._ended,t._tasks[i]=null,null==t._error&&(null!=r?o(t,r):(t._data[i]=n,t._waiting?a(t):s(t))))}}function o(t,i){var r,n=t._tasks.length;for(t._error=i,t._data=void 0,t._waiting=NaN;--n>=0;)if((r=t._tasks[n])&&(t._tasks[n]=null,r.abort))try{r.abort()}catch(i){}t._active=NaN,s(t)}function s(t){if(!t._active&&t._call){var i=t._data;t._data=void 0,t._call(t._error,i)}}function l(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new n(t)}n.prototype=l.prototype={constructor:n,defer:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var r=i.call(arguments,1);return r.push(t),++this._waiting,this._tasks.push(r),a(this),this},abort:function(){return null==this._error&&o(this,new Error("abort")),this},await:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(i,r){t.apply(null,[i].concat(r))},s(this),this},awaitAll:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,s(this),this}},t.queue=l,Object.defineProperty(t,"__esModule",{value:!0})});